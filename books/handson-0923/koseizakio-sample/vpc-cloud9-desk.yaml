AWSTemplateFormatVersion: '2010-09-09'
# 東京リージョンでCloudformaion作業すること
Resources:
#------------------------------------------------------
#  VPC
#------------------------------------------------------
  Cloud9desk:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 19.0.0.0/16
      EnableDnsHostnames: true
      EnableDnsSupport: true
      Tags:
        - Key: Name
          Value: "Cloud9desk"
#------------------------------------------------------
#  サブネット
#------------------------------------------------------
  PublicSubnetA:
      Type: AWS::EC2::Subnet
      Properties:
        AvailabilityZone: !Sub ${AWS::Region}a
        CidrBlock: 19.0.0.0/24
        MapPublicIpOnLaunch: 'true'
        VpcId: !Ref Cloud9desk
        Tags:
        - Key: Name
          Value: "Cloud9desk"
#------------------------------------------------------
#  インターネットゲートウェイ
#------------------------------------------------------
  InternetGateway:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
        - Key: Name
          Value: Cloud9desk
  AttachGateway:
      Type: AWS::EC2::VPCGatewayAttachment
      Properties:
        InternetGatewayId: !Ref InternetGateway
        VpcId: !Ref Cloud9desk
#------------------------------------------------------
#  ルートテーブルをパブリックサブネットにアタッチ
#------------------------------------------------------
  RouteTableForPublicSubnetA:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref Cloud9desk
  RouteForPublicSubnetA:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref RouteTableForPublicSubnetA
      DestinationCidrBlock:  0.0.0.0/0
      GatewayId: !Ref InternetGateway
  AssocciateRouteTableForPublicSubnetA:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PublicSubnetA
      RouteTableId: !Ref RouteTableForPublicSubnetA
#------------------------------------------------------
#  セキュリティーグループ(EC2Instance)
#------------------------------------------------------
  EC2SecurityGroup:
      Type: AWS::EC2::SecurityGroup
      Properties:
        GroupDescription: Security Group for EC2
        VpcId: !Ref Cloud9desk
        SecurityGroupIngress:
          - IpProtocol: tcp
            FromPort: 80
            ToPort: 80
            CidrIp: 0.0.0.0/0

          - IpProtocol: tcp
            FromPort: 22
            ToPort: 22
            CidrIp: 0.0.0.0/0

          - IpProtocol: tcp
            FromPort: 443
            ToPort: 443
            CidrIp: 0.0.0.0/0
        Tags:
          - Key: Name
            Value: EC2SecurityGroup


